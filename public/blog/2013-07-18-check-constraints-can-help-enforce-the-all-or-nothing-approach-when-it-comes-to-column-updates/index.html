<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta itemprop="name" content="Check Constraints can help enforce the all or nothing approach when it comes to column updates">
<meta itemprop="description" content="If you have a set of columns inside your table that you want to allow nulls in, however if one of the columns is updated force all columns in the set to be updated, use a check constraint. In my case, I had 3 columns for delete info, which were nullable. However, if one value was updated in there, I want all three of the delete columns to require updating. I created the script below to generate the creation and removal of these constraints on a list of tables:">


<meta itemprop="datePublished" content="2013-07-18T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2013-07-18T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="368">



<meta itemprop="keywords" content="sql-server," />
<meta property="og:title" content="Check Constraints can help enforce the all or nothing approach when it comes to column updates" />
<meta property="og:description" content="If you have a set of columns inside your table that you want to allow nulls in, however if one of the columns is updated force all columns in the set to be updated, use a check constraint. In my case, I had 3 columns for delete info, which were nullable. However, if one value was updated in there, I want all three of the delete columns to require updating. I created the script below to generate the creation and removal of these constraints on a list of tables:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sheldonhull.com/blog/2013-07-18-check-constraints-can-help-enforce-the-all-or-nothing-approach-when-it-comes-to-column-updates/" />
<meta property="article:published_time" content="2013-07-18T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2013-07-18T00:00:00&#43;00:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Check Constraints can help enforce the all or nothing approach when it comes to column updates"/>
<meta name="twitter:description" content="If you have a set of columns inside your table that you want to allow nulls in, however if one of the columns is updated force all columns in the set to be updated, use a check constraint. In my case, I had 3 columns for delete info, which were nullable. However, if one value was updated in there, I want all three of the delete columns to require updating. I created the script below to generate the creation and removal of these constraints on a list of tables:"/>

	<link rel="apple-touch-icon" sizes="180x180" href="https://www.sheldonhull.com/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://www.sheldonhull.com/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://www.sheldonhull.com/favicon-16x16.png">
	<link rel="manifest" href="https://www.sheldonhull.com/site.webmanifest">
	<link rel="mask-icon" href="https://www.sheldonhull.com/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="https://www.sheldonhull.com/favicon.ico">

	<title>Check Constraints can help enforce the all or nothing approach when it comes to column updates</title>
	<link rel="stylesheet" href="https://www.sheldonhull.com/css/style.min.31706917653d2b9e8410abd431f30ec4359a88a94fc87a63654779d87329edec.css" integrity="sha256-MXBpF2U9K56EEKvUMfMOxDWaiKlPyHpjZUd52HMp7ew=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://www.sheldonhull.com">sheldonhull.com</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://www.sheldonhull.com/blog/">Blog</a>
					<a href="https://www.sheldonhull.com/docs/">Docs</a>
					<a href="https://www.sheldonhull.com/tags/">Tags</a>
					<a href="https://www.sheldonhull.com/about/">About</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://www.sheldonhull.com/blog/">Blog</a></li>
			<li><a href="https://www.sheldonhull.com/docs/">Docs</a></li>
			<li><a href="https://www.sheldonhull.com/tags/">Tags</a></li>
			<li><a href="https://www.sheldonhull.com/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>Check Constraints can help enforce the all or nothing approach when it comes to column updates</h1>
		<div class="content">
			<p>If you have a set of columns inside your table that you want to allow nulls in, however if one of the columns is updated force all columns in the set to be updated, use a check constraint. In my case, I had 3 columns for delete info, which were nullable. However, if one value was updated in there, I want all three of the delete columns to require updating. I created the script below to generate the creation and removal of these constraints on a list of tables:</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="cm">/* CHECK CONSTRAINT TO ENSURE SET OF COLUMNS IS NULL OR IF UPDATED,
</span><span class="cm">THAT ALL COLUMNS IN SET ARE UPDATED Columns: delete_date null delete_by_id null delete_comment null PASS CONDITION
</span><span class="cm">1: IF ALL COLUMNS NULL = PASS PASS CONDITION
</span><span class="cm">2: IF ALL COLUMNS ARE UPDATED/NOT NULL = PASS
</span><span class="cm">
</span><span class="cm">FAIL: IF 1,2 OF THE COLUMNS ARE UPDATED, BUT NOT ALL 3 THEN FAIL
</span><span class="cm">*/</span>

<span class="cm">/* GENERATE CHECK CONSTRAINT ON ALL SELECTED TABLES TO REQUIRE ALL DELETE
</span><span class="cm">DATE COLUMNS TO BE UPDATED CORRECTLY */</span>

<span class="k">select</span>
    <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span>
    <span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span>
    <span class="p">,</span><span class="n">script_to_remove_if_exists</span> <span class="o">=</span> <span class="s1">&#39; IF exists (select * from sys.objects where name =&#39;&#39;check_&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span> <span class="o">+</span> <span class="s1">&#39;_softdelete_requires_all_delete_columns_populated_20130718&#39;&#39;) begin alter table &#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span> <span class="o">+</span> <span class="s1">&#39; drop constraint check_&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span> <span class="o">+</span> <span class="s1">&#39;_softdelete_requires_all_delete_columns_populated_20130718 end &#39;</span>
    <span class="p">,</span><span class="n">script_to_run</span> <span class="o">=</span>              <span class="s1">&#39; alter table &#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span> <span class="o">+</span> <span class="s1">&#39; add constraint check_&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span> <span class="o">+</span> <span class="s1">&#39;_softdelete_requires_all_delete_columns_populated_20130718 check ( ( case when delete_date is not null then 1 else 0 end + case when delete_by_id is not null then 1 else 0 end + case when delete_comment is not null then 1 else 0 end ) in (0, 3) ) &#39;</span>
<span class="k">from</span>
    <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">TABLES</span> <span class="n">t</span>
<span class="k">where</span>
    <span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span> <span class="k">like</span> <span class="s1">&#39;mytablename%&#39;</span>
    <span class="k">and</span> <span class="k">exists</span> <span class="p">(</span><span class="k">select</span>
            <span class="o">*</span>
        <span class="k">from</span>
            <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span> <span class="k">C</span>
        <span class="k">where</span>
            <span class="n">t</span><span class="p">.</span><span class="n">TABLE_CATALOG</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="n">TABLE_CATALOG</span>
            <span class="k">and</span> <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span>
            <span class="k">and</span> <span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="k">TABLE_NAME</span>
            <span class="k">and</span> <span class="k">C</span><span class="p">.</span><span class="k">COLUMN_NAME</span> <span class="o">=</span> <span class="s1">&#39;delete_by_id&#39;</span><span class="p">)</span>
    <span class="k">and</span> <span class="k">exists</span> <span class="p">(</span><span class="k">select</span>
            <span class="o">*</span>
        <span class="k">from</span>
            <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span> <span class="k">C</span>
        <span class="k">where</span>
            <span class="n">t</span><span class="p">.</span><span class="n">TABLE_CATALOG</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="n">TABLE_CATALOG</span>
            <span class="k">and</span> <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span>
            <span class="k">and</span> <span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="k">TABLE_NAME</span>
            <span class="k">and</span> <span class="k">C</span><span class="p">.</span><span class="k">COLUMN_NAME</span> <span class="o">=</span> <span class="s1">&#39;delete_comment&#39;</span><span class="p">)</span>
    <span class="k">and</span> <span class="k">exists</span> <span class="p">(</span><span class="k">select</span>
            <span class="o">*</span>
        <span class="k">from</span>
            <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span> <span class="k">C</span>
        <span class="k">where</span>
            <span class="n">t</span><span class="p">.</span><span class="n">TABLE_CATALOG</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="n">TABLE_CATALOG</span>
            <span class="k">and</span> <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span>
            <span class="k">and</span> <span class="n">t</span><span class="p">.</span><span class="k">TABLE_NAME</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="k">TABLE_NAME</span>
            <span class="k">and</span> <span class="k">C</span><span class="p">.</span><span class="k">COLUMN_NAME</span> <span class="o">=</span> <span class="s1">&#39;delete_date&#39;</span><span class="p">)</span>
<span class="k">order</span> <span class="k">by</span>
    <span class="n">t</span><span class="p">.</span><span class="n">TABLE_SCHEMA</span> <span class="k">asc</span>
<span class="k">go</span></code></pre></div>
		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="https://www.sheldonhull.com"></a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://www.sheldonhull.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://www.sheldonhull.com/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js" integrity="sha256-eEQX9YRxUfhIwznPCssToGy7ZIsUg0NaKO1FVsTq1ps="></script>

</body>

</html>
