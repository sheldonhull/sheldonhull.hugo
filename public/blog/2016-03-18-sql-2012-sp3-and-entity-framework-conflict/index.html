<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta itemprop="name" content="SQL 2012 SP3 and entity framework conflict">
<meta itemprop="description" content="the problem An issue with SQL Server 2012 SP3 was identified that impacted EF4/5 due to additional datatypes in the dll.
System.EntryPointNotFoundException: Unable to find an entry point named &#39;SetClrFeatureSwitchMap&#39; in DLL &#39;SqlServerSpatial110.dll&#39; diagnosing To easily identify the available dll versions of sql server, I ran a quick adhoc bat file.
The output returns a simple text file like this:
A post in technet mentioned that the DLL shipped with SP3 could cause these conflicts and if the uninstall didn&rsquo;t clean up the GAC correctly, problems could occur with Entity Framework calls.">


<meta itemprop="datePublished" content="2016-03-18T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2016-03-18T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="277">



<meta itemprop="keywords" content="entity-framework,sql-server," />
<meta property="og:title" content="SQL 2012 SP3 and entity framework conflict" />
<meta property="og:description" content="the problem An issue with SQL Server 2012 SP3 was identified that impacted EF4/5 due to additional datatypes in the dll.
System.EntryPointNotFoundException: Unable to find an entry point named &#39;SetClrFeatureSwitchMap&#39; in DLL &#39;SqlServerSpatial110.dll&#39; diagnosing To easily identify the available dll versions of sql server, I ran a quick adhoc bat file.
The output returns a simple text file like this:
A post in technet mentioned that the DLL shipped with SP3 could cause these conflicts and if the uninstall didn&rsquo;t clean up the GAC correctly, problems could occur with Entity Framework calls." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sheldonhull.com/blog/2016-03-18-sql-2012-sp3-and-entity-framework-conflict/" />
<meta property="article:published_time" content="2016-03-18T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2016-03-18T00:00:00&#43;00:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SQL 2012 SP3 and entity framework conflict"/>
<meta name="twitter:description" content="the problem An issue with SQL Server 2012 SP3 was identified that impacted EF4/5 due to additional datatypes in the dll.
System.EntryPointNotFoundException: Unable to find an entry point named &#39;SetClrFeatureSwitchMap&#39; in DLL &#39;SqlServerSpatial110.dll&#39; diagnosing To easily identify the available dll versions of sql server, I ran a quick adhoc bat file.
The output returns a simple text file like this:
A post in technet mentioned that the DLL shipped with SP3 could cause these conflicts and if the uninstall didn&rsquo;t clean up the GAC correctly, problems could occur with Entity Framework calls."/>

	<link rel="apple-touch-icon" sizes="180x180" href="https://www.sheldonhull.com/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://www.sheldonhull.com/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://www.sheldonhull.com/favicon-16x16.png">
	<link rel="manifest" href="https://www.sheldonhull.com/site.webmanifest">
	<link rel="mask-icon" href="https://www.sheldonhull.com/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="https://www.sheldonhull.com/favicon.ico">

	<title>SQL 2012 SP3 and entity framework conflict</title>
	<link rel="stylesheet" href="https://www.sheldonhull.com/css/style.min.31706917653d2b9e8410abd431f30ec4359a88a94fc87a63654779d87329edec.css" integrity="sha256-MXBpF2U9K56EEKvUMfMOxDWaiKlPyHpjZUd52HMp7ew=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://www.sheldonhull.com">sheldonhull.com</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://www.sheldonhull.com/blog/">Blog</a>
					<a href="https://www.sheldonhull.com/docs/">Docs</a>
					<a href="https://www.sheldonhull.com/tags/">Tags</a>
					<a href="https://www.sheldonhull.com/about/">About</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://www.sheldonhull.com/blog/">Blog</a></li>
			<li><a href="https://www.sheldonhull.com/docs/">Docs</a></li>
			<li><a href="https://www.sheldonhull.com/tags/">Tags</a></li>
			<li><a href="https://www.sheldonhull.com/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>SQL 2012 SP3 and entity framework conflict</h1>
		<div class="content">
			

<h2 id="the-problem">the problem<a href="#the-problem" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>An issue with SQL Server 2012 SP3 was identified that impacted EF4/5 due to additional datatypes in the dll.</p>
<div class="highlight"><pre class="chroma">System.EntryPointNotFoundException: Unable to find an entry point named &#39;SetClrFeatureSwitchMap&#39; in DLL &#39;SqlServerSpatial110.dll&#39;</pre></div>
<h2 id="diagnosing">diagnosing<a href="#diagnosing" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>To easily identify the available dll versions of sql server, I ran a quick adhoc bat file.</p>

<p><script type="text/javascript" src="https://gist.github.com/88ff6ce9caa927a27804.js"></script>

 The output returns a simple text file like this:</p>

<p><img src="https://www.sheldonhull.com/assets/img/SNAG-0035_pucmdd.jpg" alt="" />
A post in technet mentioned that the DLL shipped with SP3 could cause these conflicts and if the uninstall didn&rsquo;t clean up the GAC correctly, problems could occur with Entity Framework calls.</p>

<blockquote>
<p>Can confirm in my case it was due to dll shipped in SQL Server SP3.  I had to uninstall the patch but the newer dll was still in the gac so I had to overwrite with the older version using gacutil. ( <a href="https://social.technet.microsoft.com/Forums/appvirtualization/en-US/72d07fcb-e3cb-45f1-bff5-abeb13adc5f8/entity-framework-cant-make-updates-in-db-missing-entry-point-setclrfeatureswitchmap-in?forum=sqldataaccess">Edited by snowcow Thursday, January 14, 2016 12:41 PM</a> )</p>
</blockquote>

<h1 id="the-fix">The Fix<a href="#the-fix" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>In my case, I still needed the current SP3 version, but we wanted to make sure that the app was pointing to the older version to avoid this error.
I apparently needed to point backwards to:  <code>C:\Windows\assembly\GAC_MSIL\Microsoft.SqlServer.Types\10.0.0.0__89845dcd8080cc91</code>
Stack Overflow, the golden mecca of programming knowledge, saved the day with a solid answer</p>

<blockquote>
<p><a href="http://stackoverflow.com/a/34431276/68698">EF Cannot Update Database</a>
This forces the EntityFramework to use the version 10 of the SqlServer.Types.dll, which doesn&rsquo;t have the Geometry type apparently. - KdBoer
When the fix was applied to map the application config to the older version of the Microsoft.SqlServer.Types.dll (in this case 10). Apparently the 2012 SP3 provided some additional functionality in the dll and this had a conflict with Entity Framework 4 for my situation (and according to online posts EF5 also had some issues)</p>
</blockquote>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="https://www.sheldonhull.com"></a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://www.sheldonhull.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://www.sheldonhull.com/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js" integrity="sha256-eEQX9YRxUfhIwznPCssToGy7ZIsUg0NaKO1FVsTq1ps="></script>

</body>

</html>
