<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta itemprop="name" content="Fixing non-deterministic error when creating indexed view">
<meta itemprop="description" content="I discovered a bit of info on working with float values, while creating a hash value that contained a float value, and a date value.
create unique clustered index ix_clustered_ViewK_Catfood_K Msg 1901, Level 16, State 1, Line 1517 Cannot create index or statistics &#39;ix_clustered_ViewK_Catfood_K&#39; on view &#39;compareCatfood&#39; because key column &#39;ViewK&#39; is imprecise, computed and not persisted. Consider removing reference to column in view index or statistics key or changing column to be precise.">


<meta itemprop="datePublished" content="2016-10-09T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2016-10-09T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="298">



<meta itemprop="keywords" content="sql-server," />
<meta property="og:title" content="Fixing non-deterministic error when creating indexed view" />
<meta property="og:description" content="I discovered a bit of info on working with float values, while creating a hash value that contained a float value, and a date value.
create unique clustered index ix_clustered_ViewK_Catfood_K Msg 1901, Level 16, State 1, Line 1517 Cannot create index or statistics &#39;ix_clustered_ViewK_Catfood_K&#39; on view &#39;compareCatfood&#39; because key column &#39;ViewK&#39; is imprecise, computed and not persisted. Consider removing reference to column in view index or statistics key or changing column to be precise." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sheldonhull.com/blog/2016-10-09-fixing-non-deterministic-error-when-creating-indexed-view/" />
<meta property="article:published_time" content="2016-10-09T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2016-10-09T00:00:00&#43;00:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Fixing non-deterministic error when creating indexed view"/>
<meta name="twitter:description" content="I discovered a bit of info on working with float values, while creating a hash value that contained a float value, and a date value.
create unique clustered index ix_clustered_ViewK_Catfood_K Msg 1901, Level 16, State 1, Line 1517 Cannot create index or statistics &#39;ix_clustered_ViewK_Catfood_K&#39; on view &#39;compareCatfood&#39; because key column &#39;ViewK&#39; is imprecise, computed and not persisted. Consider removing reference to column in view index or statistics key or changing column to be precise."/>

	<link rel="apple-touch-icon" sizes="180x180" href="https://www.sheldonhull.com/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://www.sheldonhull.com/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://www.sheldonhull.com/favicon-16x16.png">
	<link rel="manifest" href="https://www.sheldonhull.com/site.webmanifest">
	<link rel="mask-icon" href="https://www.sheldonhull.com/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="https://www.sheldonhull.com/favicon.ico">

	<title>Fixing non-deterministic error when creating indexed view</title>
	<link rel="stylesheet" href="https://www.sheldonhull.com/css/style.min.31706917653d2b9e8410abd431f30ec4359a88a94fc87a63654779d87329edec.css" integrity="sha256-MXBpF2U9K56EEKvUMfMOxDWaiKlPyHpjZUd52HMp7ew=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://www.sheldonhull.com">sheldonhull.com</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://www.sheldonhull.com/blog/">Blog</a>
					<a href="https://www.sheldonhull.com/docs/">Docs</a>
					<a href="https://www.sheldonhull.com/tags/">Tags</a>
					<a href="https://www.sheldonhull.com/about/">About</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://www.sheldonhull.com/blog/">Blog</a></li>
			<li><a href="https://www.sheldonhull.com/docs/">Docs</a></li>
			<li><a href="https://www.sheldonhull.com/tags/">Tags</a></li>
			<li><a href="https://www.sheldonhull.com/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>Fixing non-deterministic error when creating indexed view</h1>
		<div class="content">
			

<p>I discovered a bit of info on working with float values, while creating a hash value that contained a float value, and a date value.</p>
<div class="highlight"><pre class="chroma">create unique clustered index ix_clustered_ViewK_Catfood_K
Msg 1901, Level 16, State 1, Line 1517
Cannot create index or statistics &#39;ix_clustered_ViewK_Catfood_K&#39; on view &#39;compareCatfood&#39; because key column &#39;ViewK&#39; is imprecise, computed and not persisted. Consider removing reference to column in view index or statistics key or changing column to be precise. If column is computed in base table consider marking it PERSISTED there.</pre></div>
<p>And&hellip;</p>
<div class="highlight"><pre class="chroma">Msg 2729, Level 16, State 1, Line 38
Column &#39;Hash&#39; in view &#39;compare.Catfood_test&#39; cannot be used in an index or statistics or as a partition key because it is non-deterministic.</pre></div>
<p>Stack Overflow to the rescue&hellip; The issue is with float values.
<a href="http://stackoverflow.com/a/19915032/68698">http://stackoverflow.com/a/19915032/68698</a></p>

<blockquote>
<p>Even if an expression is deterministic, if it contains float expressions, the exact result may depend on the processor architecture or version of microcode. To ensure data integrity, such expressions can participate only as non-key columns of indexed views. Deterministic expressions that do not contain float expressions are called precise. Only precise deterministic expressions can participate in key columns and in WHERE or GROUP BY clauses of indexed views. <a href="http://bit.ly/2btYtxp">MSDN</a>
Restrictions also apply to formatting dates when you are calculating a checksum. This is because every region has variations on the way the date may be displayed. This makes dates non-deterministic in a hash, unless the convert format is explicitly defined.</p>
</blockquote>

<h1 id="ensuring-date-is-converted-with-style">ensuring date is converted with style<a href="#ensuring-date-is-converted-with-style" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<div class="highlight"><pre class="chroma">+ isnull(convert(nvarchar(max), do oe.Somedate ,102), &#39;&#39;&#39;) + N&#39;&#39;&#39;
+ isnull(convert(nvarchar(max),la.SomeDater ,102), N&#39;&#39;&#39;) + N&#39;&#39;&#39;
+ isnull(cast  (ft.ToBeOrNotToBe as nvarchar(max)),&#39;&#39;&#39;) + N&#39;&#39;&#39;
+ isnull(cast  (t2.Fooey as nvarchar(max)),&#39;&#39;&#39;) + N&#39;&#39;&#39;</pre></div>
<p>If you can resolve these issues then you are on your way to resolving the other thousand restrictions on indexed views&hellip;. :-)  Good luck!</p>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="https://www.sheldonhull.com"></a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://www.sheldonhull.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://www.sheldonhull.com/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js" integrity="sha256-eEQX9YRxUfhIwznPCssToGy7ZIsUg0NaKO1FVsTq1ps="></script>

</body>

</html>
