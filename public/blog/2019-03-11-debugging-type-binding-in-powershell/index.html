<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta itemprop="name" content="Debugging Type Binding in PowerShell">
<meta itemprop="description" content="Some effort I spent in researching Type Binding in Stack Overflow to help answer a question by Chris Oldwood helped me solidify my understanding of the best way to debug more complicated scenarios such as this in PowerShell.
 Why does this PowerShell function&rsquo;s default argument change value based on the use of . or &amp; to invoke a command within it? 
 Spent some digging into this and this is what I&rsquo;ve observed.">


<meta itemprop="datePublished" content="2019-03-11T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-03-11T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="741">



<meta itemprop="keywords" content="powershell,deep-dive," />
<meta property="og:title" content="Debugging Type Binding in PowerShell" />
<meta property="og:description" content="Some effort I spent in researching Type Binding in Stack Overflow to help answer a question by Chris Oldwood helped me solidify my understanding of the best way to debug more complicated scenarios such as this in PowerShell.
 Why does this PowerShell function&rsquo;s default argument change value based on the use of . or &amp; to invoke a command within it? 
 Spent some digging into this and this is what I&rsquo;ve observed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sheldonhull.com/blog/2019-03-11-debugging-type-binding-in-powershell/" />
<meta property="article:published_time" content="2019-03-11T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-03-11T00:00:00&#43;00:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Debugging Type Binding in PowerShell"/>
<meta name="twitter:description" content="Some effort I spent in researching Type Binding in Stack Overflow to help answer a question by Chris Oldwood helped me solidify my understanding of the best way to debug more complicated scenarios such as this in PowerShell.
 Why does this PowerShell function&rsquo;s default argument change value based on the use of . or &amp; to invoke a command within it? 
 Spent some digging into this and this is what I&rsquo;ve observed."/>

	<link rel="apple-touch-icon" sizes="180x180" href="https://www.sheldonhull.com/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://www.sheldonhull.com/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://www.sheldonhull.com/favicon-16x16.png">
	<link rel="manifest" href="https://www.sheldonhull.com/site.webmanifest">
	<link rel="mask-icon" href="https://www.sheldonhull.com/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="https://www.sheldonhull.com/favicon.ico">

	<title>Debugging Type Binding in PowerShell</title>
	<link rel="stylesheet" href="https://www.sheldonhull.com/css/style.min.31706917653d2b9e8410abd431f30ec4359a88a94fc87a63654779d87329edec.css" integrity="sha256-MXBpF2U9K56EEKvUMfMOxDWaiKlPyHpjZUd52HMp7ew=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://www.sheldonhull.com">sheldonhull.com</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://www.sheldonhull.com/blog/">Blog</a>
					<a href="https://www.sheldonhull.com/docs/">Docs</a>
					<a href="https://www.sheldonhull.com/tags/">Tags</a>
					<a href="https://www.sheldonhull.com/about/">About</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://www.sheldonhull.com/blog/">Blog</a></li>
			<li><a href="https://www.sheldonhull.com/docs/">Docs</a></li>
			<li><a href="https://www.sheldonhull.com/tags/">Tags</a></li>
			<li><a href="https://www.sheldonhull.com/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>Debugging Type Binding in PowerShell</h1>
		<div class="content">
			

<p>Some effort I spent in researching Type Binding in Stack Overflow to help answer a question by <a href="https://stackoverflow.com/users/106119/chris-oldwood">Chris Oldwood</a> helped me solidify my understanding of the best way to debug more  complicated scenarios such as this in PowerShell.</p>

<blockquote>
<p><a href="https://stackoverflow.com/q/53860403/68698">Why does this PowerShell function&rsquo;s default argument change value based on the use of . or &amp; to invoke a command within it? </a></p>
</blockquote>

<p>Spent some digging into this and this is what I&rsquo;ve observed.</p>

<p>First for clarity I do not believe that you should consider the NullString value the same as null in a basic comparison. Not sure why you need this either, as this is normally something I&rsquo;d expect from c# development. You should be able to just use <code>$null</code> for most work in PowerShell.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">if</span><span class="p">(</span><span class="nv">$null</span> <span class="o">-eq</span> <span class="no">[System.Management.Automation.Language.NullString]</span><span class="p">::</span><span class="n">Value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">write-host</span> <span class="s2">&#34;</span><span class="se">`$</span><span class="s2">null -eq [System.Management.Automation.Language.NullString]::Value&#34;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="nb">write-host</span> <span class="s2">&#34;</span><span class="se">`$</span><span class="s2">null -ne [System.Management.Automation.Language.NullString]::Value&#34;</span>
<span class="p">}</span></code></pre></div>
<p>Secondly, the issue is not necessarily because of the call operator, ie <code>&amp;</code>. I believe instead you are dealing with underlying parameter binding coercion. Strong data typing is definitely a weak area for PowerShell, as even explicitly declared <code>[int]$val</code> could end up being set to a string type by PowerShell automatically in the next line when writing <code>Write-Host $Val</code>.</p>

<p>To identify the underlying behavior, I used the <code>Trace-Command</code> function (<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/trace-command?view=powershell-6">Trace Command</a>) .</p>

<p>I changed the Use-Dot to just call the function as no write-host was needed to output the string.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">function</span> <span class="nb">Use-Ampersand</span>
<span class="p">{</span>
    <span class="k">param</span><span class="p">(</span>
        <span class="no">[string]</span><span class="nv">$NullString</span> <span class="p">=</span> <span class="no">[System.Management.Automation.Language.NullString]</span><span class="p">::</span><span class="n">Value</span>
    <span class="p">)</span>
    <span class="nb">Format-Type</span> <span class="nv">$NullString</span>
    <span class="p">&amp;</span><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span> <span class="p">/</span><span class="n">c</span> <span class="n">exit</span> <span class="n">0</span>
<span class="p">}</span></code></pre></div>
<p>The Format-Type I modified to also use what is considered a better practice of <code>$null</code> on the left, again due to type inference.</p>
<div class="highlight"><pre class="chroma">function Format-Type($v= [System.Management.Automation.Language.NullString]::Value)
{

    if ($null  -eq $v)
    {
     &#39;(null)&#39;
    }
    else {
        $v.GetType().FullName
     }
}</pre></div>
<p>To narrow down the issue with the data types, I used the following commands, though this is not where I found insight into the issue. Theyh  when called directly worked the same.</p>
<div class="highlight"><pre class="chroma">Trace-Command -Name TypeConversion -Expression { Format-Type $NullString} -PSHost
Trace-Command -Name TypeConversion -Expression { Format-Type ([System.Management.Automation.Language.NullString]$NullString) } -PSHost</pre></div>
<p>However, when I ran the functions using TypeConversion tracing, it showed a difference in the conversions that likely explains some of your observed behavior.</p>
<div class="highlight"><pre class="chroma">Trace-Command -Name TypeConversion  -Expression { Use-Dot} -PSHost
Trace-Command -Name TypeConversion  -Expression { Use-Ampersand} -PSHost</pre></div><div class="highlight"><pre class="chroma"># USE DOT
DEBUG: TypeConversion Information: 0 :  Converting &#34;&#34; to &#34;System.String&#34;.
DEBUG: TypeConversion Information: 0 :      Converting object to string.
DEBUG: TypeConversion Information: 0 :  Converting &#34;&#34; to &#34;System.Object&#34;. &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
DEBUG: TypeConversion Information: 0 :  Converting &#34;.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW;.CPL&#34; to &#34;System.String&#34;.
DEBUG: TypeConversion Information: 0 :      Result type is assignable from value to convert&#39;s type</pre></div>
<p><code>OUTPUT: (null)</code></p>
<div class="highlight"><pre class="chroma"># Use-Ampersand
DEBUG: TypeConversion Information: 0 : Converting &#34;&#34; to &#34;System.String&#34;.
DEBUG: TypeConversion Information: 0 :     Converting object to string.
DEBUG: TypeConversion Information: 0 : Converting &#34;&#34; to &#34;System.String&#34;. &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
DEBUG: TypeConversion Information: 0 :     Converting null to &#34;&#34;.        &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
DEBUG: TypeConversion Information: 0 : Converting &#34;.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW;.CPL&#34; to &#34;System.String&#34;.
DEBUG: TypeConversion Information: 0 :     Result type is assignable from value to convert&#39;s type</pre></div>
<p><code>OUTPUT: System.String</code></p>

<p>The noticeable difference is in <code>Use-Ampersand</code> it shows a statement of <code>Converting null to &quot;&quot;</code> vs <code>Converting &quot;&quot; to &quot;System.Object&quot;</code>.</p>

<p>In PowerShell, <code>$null &lt;&gt; [string]''</code>. An empty string comparison will pass the null check, resulting in the success of outputting <code>GetType()</code>.</p>

<h1 id="a-few-thoughts-on-approach-with-powershell">A Few Thoughts On Approach With PowerShell<a href="#a-few-thoughts-on-approach-with-powershell" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>Why it&rsquo;s doing this, I&rsquo;m not certain, but before you invest more time researching, let me provide one piece of advice based on learning the hard way.</p>

<p><em>If start dealing with issues due to trying to coerce data types in PowerShell, first consider if PowerShell is the right tool for the job</em></p>

<p>Yes, you can use type extensions. Yes, you can use .NET data types like <code>$List = [System.Collections.Generic.List[string]]::new()</code> and some .NET typed rules can be enforced. However, PowerShell is not designed to be a strongly typed language like C#. Trying to approach it like this will result in a many difficulties. While I&rsquo;m a huge fan of PowerShell, I&rsquo;ve learned to recognize that it&rsquo;s flexibility should be appreciated, and it&rsquo;s limits respected.</p>

<p>If I really had issues that required mapping <code>[System.Management.Automation.Language.NullString]::Value</code> so strongly, I&rsquo;d consider my approach.</p>

<p>That said, this was a challenging investigation that I had to take a swing at, while providing my 10 cents afterwards.</p>

<h1 id="other-resources">Other Resources<a href="#other-resources" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>After posting my answer, I found another <a href="https://stackoverflow.com/a/51354791/68698">answer</a> that seemed relevant, and also backs up the mentioning of not using <code>[NullString]</code> normally, as its usage in PowerShell is not really what it was designed for.</p>

<p><em>Stackoverflow specific content republished under CC-BY-SA</em></p>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="https://www.sheldonhull.com"></a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://www.sheldonhull.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://www.sheldonhull.com/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js" integrity="sha256-eEQX9YRxUfhIwznPCssToGy7ZIsUg0NaKO1FVsTq1ps="></script>

</body>

</html>
