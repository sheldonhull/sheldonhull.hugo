<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:dc='http://purl.org/dc/elements/1.1/'>
    <channel>
        <title>Testing - Tag - sheldonhull.com</title>
        <link>https://www.sheldonhull.com/tags/testing/</link>
        <description>Testing - Tag - sheldonhull.com</description>
        <generator>Hugo -- gohugo.io</generator><language>en</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Mon, 20 Apr 2020 13:00:00 &#43;0000</lastBuildDate><atom:link href="https://www.sheldonhull.com/tags/testing/" rel="self" type="application/rss+xml" />

<item>
    <title>
        Using Pester to Improve Operational Tasks
    </title>
    <link>
        https://www.sheldonhull.com/using-pester-to-improve-operational-tasks/
    </link>
    <pubDate>
        Mon, 20 Apr 2020 13:00:00 &#43;0000
    </pubDate>
    
    
    <guid>
        https://www.sheldonhull.com/using-pester-to-improve-operational-tasks/
    </guid>
    <description>
        <![CDATA[
        
        
        
            
        
        <h2 id="taking-the-time-to-test" class="headerLink">
    <a href="#taking-the-time-to-test" class="header-mark"></a>Taking the Time To Test</h2><p>Requirements in a constant state of change set you up for failure.</p>
<p>Failure to work through requirements before starting can also increase the risk of failure.</p>
<p>Planning with defined acceptance criteria of work you are committing to is not about filling in more documentation and work that no one cares about. Properly defining the acceptance criteria for yourself is about the exploratory process that defines and limits the scope of the work to deliver the minimum viable product. This allows continued momentum and delivery of value to the business.</p>
<h2 id="doesnt-this-create-more-busy-work-for-me" class="headerLink">
    <a href="#doesnt-this-create-more-busy-work-for-me" class="header-mark"></a>Doesn&rsquo;t this create more busy work for me?</h2><p>Without effective acceptance criteria, <em>you are setting yourself up for more work</em>, and thus likely to deliver value to the business as quickly. From my perspective, if you cannot truly define the acceptance criteria for work, then it&rsquo;s likely the effort will result in less value, be difficult to deliver, or end up with scope creep.</p>
<p><em>This is a critical thing to communicate to any teams struggling with reactive work.</em> Without spending time ensuring proactive planning and defining the requirement and acceptance criteria, more time is often spent reworking and solving problems that might have been better handled with a little planning and forethought.</p>
<p>A classic example of unclear acceptance criteria and the wasteful impact of work is from a youtube clip here.</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube-nocookie.com/embed/BTTdHW8Z668" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>How many times have you started work on a project and found yourself in a similar situation?</p>
<blockquote>
<p>&ldquo;There are many reasons why software projects go wrong. A very common reason is that different people in the organization or on the team have very different understandings of how the software should behave, and what problems it‚Äôs trying to solve. Ignorance is the single greatest impediment to throughput&rdquo;
Teams that deliberately seek to discover what they are ignorant about before development starts are more productive because there is less rework.
The most effective way to do this is through conversation and collaboration between key stakeholders&hellip;
Dan North</p>
</blockquote>
<h2 id="small-steps-in-testing" class="headerLink">
    <a href="#small-steps-in-testing" class="header-mark"></a>Small Steps In Testing</h2><p>Now that I did my high-level philosophizing &hellip; let&rsquo;s do something more low level and fun.</p>
<h3 id="an-example-of-adding-tests-to-devops-oriented-tasks" class="headerLink">
    <a href="#an-example-of-adding-tests-to-devops-oriented-tasks" class="header-mark"></a>An example of adding tests to DevOps oriented tasks</h3><p>If we want to apply the &ldquo;software engineer solving operational problems&rdquo; approach to a very simple task, we could take the example of deploying a logging agent.</p>
<p>A software engineer expects a healthy culture to include tests for any code they write.
This ensures better quality, more rapid velocity in changes, and other benefits that TDD advocates can tell you in other places.</p>
<p>For our example, let&rsquo;s say we are deploying a monitoring agent on some servers.</p>
<h3 id="gherkin" class="headerLink">
    <a href="#gherkin" class="header-mark"></a>Gherkin</h3><p>Gherkin is the syntax used to describe the tests.</p>
<div
    class="details admonition info
      open
    "
  >
    <div class="details-summary admonition-title">
      <i
        class="icon fas fa-info-circle fa-fw"
      ></i>
      Pester Syntax
      <i class="details-icon fas fa-angle-right fa-fw"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">You can write Pester tests with PowerShell in a different format, but I&rsquo;m going to use Gherkin here because of its sentences and far less of a confusing DSL for our example.</div>
    </div>
  </div>
<p>My understanding would be to compare Cucumber &ldquo;spoken word&rdquo;, and Gherkin as the &ldquo;language&rdquo; chosen to communicate.
When you write the feature files to work with Cucumber, you write them in Gherkin.
Gherkin is supported for automated testing in many scripting languages.
In a Windows environment, for example, you can use it to check many things like services running, connectivity with a server, installation of an app, and more using invocation via Pester.</p>
<p>Most examples I&rsquo;ve found on Cucumber are focused very much on user testing, like website clicks, saving things, and other very narrow development focused actions.</p>
<p>What I&rsquo;ve failed to see as much of is the discussion on the value of using this approach with teams implementing &ldquo;Infrastructure as Code&rdquo;, operations teams, and other non-application specific roles.</p>
<h2 id="make-your-checklist-automated" class="headerLink">
    <a href="#make-your-checklist-automated" class="header-mark"></a>Make Your Checklist Automated</h2><p>In my example, let&rsquo;s start small and say you just have PowerShell, and some servers.</p>
<p>What I&rsquo;ve discovered is that to actual validate DevOps oriented work is completed, you typically go through the equivalent of what a Cucumber test would have.
This &ldquo;checklist&rdquo; of validations is often manually performed, lacking consistency and the ability to scale or repeat with minimal effort.</p>
<p>Consider an alternative approach to helping solve this issue, and expanding your ability to automate the tedious testing and validation of changes made.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cucumber" data-lang="cucumber"><span class="line"><span class="cl"><span class="nf">Scenario
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">Given </span><span class="nf">(environment state)
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">When </span><span class="nf">(something is done)
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">Then </span><span class="nf">(expected result)
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="using-pester-to-write-an-ops-test" class="headerLink">
    <a href="#using-pester-to-write-an-ops-test" class="header-mark"></a>Using Pester To Write An Ops Test</h3><p>Instead of using manual checks to validate a series of steps, let&rsquo;s see what a Cucumber oriented test might define as the acceptance criteria to confirm successfully finished, and how this might work with automating the tests.</p>
<p>This is a simple MSI with some command-line arguments that might be required.
You want to validate the chocolatey package you deploy with correctly parsed the arguments passed in, and then successfully registered with the logging services.</p>
<p>An example feature file with Gherkin might look like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cucumber" data-lang="cucumber"><span class="line"><span class="cl"><span class="nt">@class</span><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">Feature:</span><span class="nf"> I can generate configuration files for FancyLoggingVendor collection dynamically
</span></span></span><span class="line"><span class="cl"><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf">    </span><span class="k">Background:</span><span class="nf"> The test environment
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">        Given </span><span class="nf">the test environment is setup
</span></span></span><span class="line"><span class="cl"><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf">    </span><span class="k">Scenario:</span><span class="nf"> Source json is configured to collect windows event logs
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">        Given </span><span class="nf">FancyLoggingVendor json object is initialized
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">When </span><span class="nf">the package parameters request a Windows Event
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">Then </span><span class="nf">the created json file contents match
</span></span></span><span class="line"><span class="cl"><span class="nf">            </span><span class="k">&#34;&#34;&#34;</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">{
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;api.version&#34;:&#34;v1&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;sources&#34;:\[
</span></span></span><span class="line"><span class="cl"><span class="s">{
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;sourceType&#34;:&#34;LocalWindowsEventLog&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;name&#34;:&#34;GherkinTest&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;renderMessages&#34;:true,
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;cutoffRelativeTime&#34;:&#34;-1h&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;hostname&#34;:&#34;gherkintest&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;logNames&#34;:\[
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;Security&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;Application&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">\]
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">\]
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">            </span><span class="k">&#34;&#34;&#34;</span><span class="nf">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Another one that shows Scenario Outlines. This adds more functionality to looping through various variations of test cases.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gherkin" data-lang="gherkin"><span class="line"><span class="cl"><span class="k">Feature:</span><span class="nf"> I can install FancyLoggingVendor on my machine
</span></span></span><span class="line"><span class="cl"><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf">    </span><span class="k">Background:</span><span class="nf"> The local package is updated and the functions loaded
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">        Given </span><span class="nf">the test environment is setup
</span></span></span><span class="line"><span class="cl"><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf">    </span><span class="k">Scenario Outline:</span><span class="nf"> As a local user, I can install FancyLoggingVendor and configure capture my desired target
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">        Given </span><span class="nf">this package is not installed
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">When </span><span class="nf">the package source is a local nupkg file
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">And </span><span class="nf">a </span><span class="nv">&lt;Description&gt;</span><span class="nf"> is provided with the values: </span><span class="nv">&lt;Paths&gt;</span><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">Then </span><span class="nf">I can install from this source
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">And </span><span class="nf">the sources json returns sources of: </span><span class="nv">&lt;ExpectedSourcesCount&gt;</span><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">And </span><span class="nf">the application should show up in installed programs
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">And </span><span class="nf">the service should show up
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">And </span><span class="nf">the service should be running
</span></span></span><span class="line"><span class="cl"><span class="nf">        </span><span class="k">Examples:</span><span class="nf"> Source Variations</span><span class="k">
</span></span></span><span class="line"><span class="cl"><span class="k">            |</span><span class="nv"> Description</span><span class="k">              |</span><span class="nv"> Paths</span><span class="k">                              |</span><span class="nv"> ExpectedSourcesCount</span><span class="k"> |</span><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">            |</span><span class="s"> Single_File</span><span class="k">              |</span><span class="s"> C:\\temp\\taco.log</span><span class="k">                 |</span><span class="s"> 1</span><span class="k">                    |</span><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">            |</span><span class="s"> Single_File_with_Filters</span><span class="k"> |</span><span class="s"> C:\\temp\\_.log</span><span class="k">                    |</span><span class="s"> 1</span><span class="k">                    |</span><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">            |</span><span class="s"> SingleFolder</span><span class="k">             |</span><span class="s"> C:\\temp\\foobar</span><span class="k">                   |</span><span class="s"> 1</span><span class="k">                    |</span><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">            |</span><span class="s"> MultipleFolders</span><span class="k">          |</span><span class="s"> C:\\temp\\foobar,C:\\temp\\foobar2</span><span class="k"> |</span><span class="s"> 2</span><span class="k">                    |</span><span class="nf">
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="k">            |</span><span class="s"> SingleFolder_with_filter</span><span class="k"> |</span><span class="s"> C:\\temp\\foobar\\_.log</span><span class="k">            |</span><span class="s"> 1</span><span class="k">                    |
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This provides us with a way to validate and test something like a chocolatey package installation or custom install script.</p>
<h2 id="leveraging-automation-to-scale-your-test" class="headerLink">
    <a href="#leveraging-automation-to-scale-your-test" class="header-mark"></a>Leveraging Automation To Scale your Test</h2><p>So all that writing&hellip;what benefit? Is it going to save time?</p>
<p>With PowerShell, I&rsquo;d write something similar to match a called step to a code block here.</p>
<div
    class="details admonition warning
      open
    "
  >
    <div class="details-summary admonition-title">
      <i
        class="icon fas fa-exclamation-triangle fa-fw"
      ></i>
      Warning
      <i class="details-icon fas fa-angle-right fa-fw"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">Case sensitive name as of 2019-04-16 for keywords. Therefore to match steps, use <code>Before</code> not <code>before</code> or it won&rsquo;t match.</div>
    </div>
  </div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Uses PSFramework as greatly simplifies any variable scoping or general configuration work, making this type of test easily reusable</span>
</span></span><span class="line"><span class="cl"><span class="c">#this is incomplete, just to give some practical examples of how I might use to repeat a test like this.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Before</span> <span class="n">Each</span> <span class="n">Scenario</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c"># other prep work</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Given</span> <span class="s1">&#39;local package is updated and the functions loaded&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c"># package up the</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">Given</span> <span class="s1">&#39;the test environment is setup&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c"># do setup stuff here or other stuff that might be needed</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">Given</span> <span class="s1">&#39;this package is not installed&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="n">choco</span> <span class="n">uninstall</span> <span class="p">(</span><span class="nb">Get-PSFConfigValue</span> <span class="s1">&#39;gherkin.packagename&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="p">|</span> <span class="n">Should</span> <span class="o">-Not</span> <span class="n">-Throw</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">When</span> <span class="s1">&#39;the package source is a local nupkg file&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nb">Set-PSFConfig</span> <span class="s1">&#39;gherkin.packagesource&#39;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="p">(</span><span class="nb">Get-PSFConfigValue</span> <span class="s1">&#39;gherkin.packagefolder&#39;</span><span class="p">)</span> <span class="n">-Filter</span> <span class="p">*.</span><span class="n">nupkg</span><span class="p">).</span><span class="py">FullName</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Then</span> <span class="s1">&#39;I can install from this source&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$ChocoArguments</span> <span class="p">=</span> <span class="vm">@</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ChocoArguments</span> <span class="p">+=</span> <span class="s1">&#39;upgrade&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ChocoArguments</span> <span class="p">+=</span> <span class="nb">Get-PSFConfigValue</span> <span class="s1">&#39;gherkin.packagename&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ChocoArguments</span> <span class="p">+=</span> <span class="s1">&#39;--source &#34;{0}&#34;&#39;</span> <span class="o">-f</span> <span class="p">(</span><span class="nb">Get-PSFConfigValue</span> <span class="s1">&#39;gherkin.packagefolder&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ChocoArguments</span> <span class="p">+=</span> <span class="p">(</span><span class="nb">Get-PSFConfigValue</span> <span class="s1">&#39;gherkin.params&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ChocoArguments</span> <span class="p">+=</span> <span class="s1">&#39;--verbose&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="nb">Start-Process</span> <span class="n">choco</span><span class="p">.</span><span class="py">exe</span> <span class="n">-ArgumentList</span> <span class="nv">$ChocoArguments</span> <span class="n">-NoNewWindow</span> <span class="n">-PassThru</span> <span class="p">|</span> <span class="nb">Wait-Process</span> <span class="p">}</span> <span class="p">|</span> <span class="n">Should</span> <span class="o">-Not</span> <span class="n">-Throw</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">And</span> <span class="s1">&#39;the sources json returns sources of: &lt;ExpectedSourcesCount&gt;&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">param</span><span class="p">(</span><span class="nv">$ExpectedSourcesCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-PSFmessage</span> <span class="n">-Level</span> <span class="n">Important</span> <span class="n">-FunctionName</span> <span class="s1">&#39;FancyLoggingVendor.Install.steps.ps1&#39;</span> <span class="n">-Message</span> <span class="s2">&#34;ExpectedSourcesCount -- </span><span class="nv">$ExpectedSourcesCount</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$DefaultJsonFile</span> <span class="p">=</span> <span class="s1">&#39;PathToJsonHere&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">Test-Path</span> <span class="nv">$DefaultJsonFile</span> <span class="n">-PathType</span> <span class="n">Leaf</span> <span class="p">|</span> <span class="n">Should</span> <span class="n">-Be</span> <span class="vm">$True</span>
</span></span><span class="line"><span class="cl"><span class="vm">@</span><span class="p">(</span><span class="nb">Get-Content</span> <span class="nv">$DefaultJsonFile</span> <span class="n">-Raw</span> <span class="p">|</span> <span class="nb">ConvertFrom-Json</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Sources</span><span class="p">).</span><span class="py">Count</span> <span class="p">|</span> <span class="n">Should</span> <span class="n">-Be</span> <span class="nv">$ExpectedSourcesCount</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">And</span> <span class="s1">&#39;the application should show up in installed programs&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># helper function could be loaded and used to parse registry info for installed app showing up, or you could code it directly</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Get-InstalledApp</span> <span class="s1">&#39;MyAgent&#39;</span> <span class="p">|</span> <span class="n">Should</span> <span class="n">-Be</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">And</span> <span class="s1">&#39;the service should show up&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="vm">@</span><span class="p">(</span><span class="nb">Get-Service</span> <span class="s1">&#39;MyAgent*&#39;</span><span class="p">).</span><span class="py">Count</span> <span class="p">|</span> <span class="n">Should</span> <span class="n">-Be</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">And</span> <span class="s1">&#39;the service should be running&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="vm">@</span><span class="p">(</span><span class="nb">Get-Service</span> <span class="s1">&#39;MyAgent*&#39;</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="n">Status</span> <span class="o">-eq</span> <span class="s1">&#39;Running&#39;</span><span class="p">).</span><span class="py">Count</span> <span class="p">|</span> <span class="n">Should</span> <span class="n">-Be</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now that I wrote this, I could simply run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Invoke-Gherkin</span> <span class="n">-Path</span> <span class="n">InstallFancyLoggingVendor</span><span class="p">.</span><span class="py">steps</span><span class="p">.</span><span class="py">ps1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This would run all the steps from a feature file and ensure I&rsquo;m able to repeat these tests after any change to confirm they work.</p>
<h2 id="other-great-use-cases" class="headerLink">
    <a href="#other-great-use-cases" class="header-mark"></a>Other Great Use Cases</h2><p>I&rsquo;ve leveraged this to validate SQL Server configuration changes on a new AWS RDS Deployment, validate build steps completed successfully, tested file paths existing, and more. I really like how you can have this all integrated in a nice UI by uploading the nunit tests in Azure DevOps pipelines too.</p>
<h2 id="start-small" class="headerLink">
    <a href="#start-small" class="header-mark"></a>Start Small</h2><p>Take a look at the simple Pester syntax examples or the gherkin examples I gave and use that to do anything you keep having to check more than a few times. You&rsquo;ll find your efforts rewarded by having more consistent testing and probably save quite a bit of effort as well.</p>
<h2 id="helped" class="headerLink">
    <a href="#helped" class="header-mark"></a>Helped?</h2><p>If you found these concepts helpful and would like an example of using Pester to test SQL Server login authentication, user group assignment, and more, let me know. I&rsquo;ve done SQL Server pester tests using traditional Pester syntax that would validate maintenance solution deployment, login mapping, and more. If this was valuable, I could do a write-up of this.</p>
<p>If you also would like more fundamentals, I&rsquo;d be willing to do a basic Pester write-up for an operational focused task that is ground zero too, just depends if you the reader find this helpful.</p>
<p>Comments always appreciated if this helped you! Let&rsquo;s me know it&rsquo;s actually helping someone out and always great to connect with others. üçª</p>

        ]]>
    </description>
</item>
</channel>
</rss>
