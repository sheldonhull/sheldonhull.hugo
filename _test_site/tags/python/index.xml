<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:dc='http://purl.org/dc/elements/1.1/'>
    <channel>
        <title>Python - Tag - sheldonhull.com</title>
        <link>https://www.sheldonhull.com/tags/python/</link>
        <description>Python - Tag - sheldonhull.com</description>
        <generator>Hugo -- gohugo.io</generator><language>en</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Tue, 04 May 2021 07:00:00 &#43;0000</lastBuildDate><atom:link href="https://www.sheldonhull.com/tags/python/" rel="self" type="application/rss+xml" />

<item>
    <title>
        Diagrams as Code
    </title>
    <link>
        https://www.sheldonhull.com/diagrams-as-code/
    </link>
    <pubDate>
        Tue, 04 May 2021 07:00:00 &#43;0000
    </pubDate>
    
    
    <guid>
        https://www.sheldonhull.com/diagrams-as-code/
    </guid>
    <description>
        <![CDATA[
        
        
        
            
        
        <h2 id="why" class="headerLink">
    <a href="#why" class="header-mark"></a>Why</h2><p>It&rsquo;s not for everyone.</p>
<p>I prefer to write diagrams out logically and then let the visual aspect be generated.</p>
<p>This helps me by making the visual presentation an artifact of what is basically a written outline.</p>
<h2 id="presentation-matters" class="headerLink">
    <a href="#presentation-matters" class="header-mark"></a>Presentation Matters</h2><p>I&rsquo;ve learned that communicating flows of information can often be better presented visually than trying to write them out, especially once it involves more than a few &ldquo;nodes&rdquo; of responsibility. Visualizing a complicated process can be done more easily in a visual way, as well as help expose some possible issues when ownership is transfered between lanes too many times.</p>
<h2 id="options" class="headerLink">
    <a href="#options" class="header-mark"></a>Options</h2><p>LucidChart, Draw.io and other tools are great for a quick solution.</p>
<p>Mermaid also provides a nice simple text based diagramming tool that is integrated with many markdown tools.</p>
<p>For me, this just never fit. I like a bit of polish and beauty in a visual presentation and most of these are very utilitarian in their output.</p>
<p>I came across diagrams<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> and found it a perfect fit for intuitive and beautiful diagram rendering of cloud architecture, and figured it would be worth a blog post to share this.</p>
<h2 id="getting-started" class="headerLink">
    <a href="#getting-started" class="header-mark"></a>Getting Started</h2><div
    class="details admonition Warning
      open
    "
  >
    <div class="details-summary admonition-title">
      <i
        class="icon fas fa-pencil-alt fa-fw"
      ></i>
      Name Of Project
      <i class="details-icon fas fa-angle-right fa-fw"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>Do not create a project named the same thing as your dependency, ie project name = diagrams for example.</p>
<p>This will error out and send you down a search in github issues to discover this issue.</p>
</div>
    </div>
  </div>
<p>Install Poetry<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> and create a new poetry project in your directory using <code>poetry init</code>.</p>
<p>Once it gets to the package additions add <code>diagrams</code> to your poetry file.</p>
<p>Run <code>poetry install</code></p>
<p>Finally, create a new file called <code>diagram.py</code> in your directory.</p>
<p>Once you populate this file, you can run your diagram using the virtual env it manages by calling <code>poetry run python diagram.py</code>.</p>
<p>Additionally, any command line arguments you want to pass would just go through like <code>poetry run python diagram.py --outdirectory foobar</code></p>
<h2 id="diagrams" class="headerLink">
    <a href="#diagrams" class="header-mark"></a>Diagrams</h2><p>The documentation is pretty thorough, but detailed examples and shortcuts are very hard to find. You&rsquo;ll have to dig through the repo issues on occasion if you find yourself wanting to do something that isn&rsquo;t obvious. This project seems to be a wrapper around graphviz, so a lot of the documentation for parameters and customizations will be in it&rsquo;s documentation, not in this project.</p>
<p>To find available nodes and shapes, you&rsquo;ll need to look at the diagram docs<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<h2 id="simple-example" class="headerLink">
    <a href="#simple-example" class="header-mark"></a>Simple Example</h2><p>Using defaults you can create a simple diagram such as this:</p>
<p><figure><a class="lightgallery" href="/images/diagrams-as-code-01-diagram-vpc-example.png" title="vpc-diagram-simple" data-thumbnail="/images/diagrams-as-code-01-diagram-vpc-example.png">
        
    </a></figure></p>
<script src="https://gist.github.com/sheldonhull/cc8abcb86c9463b0c74bb9e4d82ffac9.js?file=01-diagram-vpc-example.py"></script>

<h2 id="add-some-helpers" class="headerLink">
    <a href="#add-some-helpers" class="header-mark"></a>Add Some Helpers</h2><p>From the github issues and my own customizations, I added a few additions to make the edge (ie, lines) flow easier to work with.</p>
<p><figure><a class="lightgallery" href="/images/diagrams-as-code-02-aws-vpc-example-with-helper.png" title="vpc-diagram-simple-with-helpers" data-thumbnail="/images/diagrams-as-code-02-aws-vpc-example-with-helper.png">
        
    </a></figure></p>
<script src="https://gist.github.com/sheldonhull/cc8abcb86c9463b0c74bb9e4d82ffac9.js?file=02.helpers.py"></script>

<h2 id="a-more-complex-example" class="headerLink">
    <a href="#a-more-complex-example" class="header-mark"></a>A More Complex Example</h2><p>I went through the AWS Reference Architecture Diagrams <sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> and used this to provide a more complex example.</p>
<p>Take a look at the AWS PDF<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> and compare.</p>
<p><figure><a class="lightgallery" href="/images/diagrams-as-code-03-complex.png" title="complex-example" data-thumbnail="/images/diagrams-as-code-03-complex.png">
        
    </a></figure></p>
<script src="https://gist.github.com/sheldonhull/cc8abcb86c9463b0c74bb9e4d82ffac9.js?file=03-diagram-complex.py"></script>

<h2 id="reference" class="headerLink">
    <a href="#reference" class="header-mark"></a>Reference</h2><table>
<thead>
<tr>
<th>Graphviz Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.graphviz.org/doc/info/attrs.html#d:color" target="_blank" rel="noopener noreferrer">Colors</a></td>
</tr>
<tr>
<td><a href="https://diagrams.mingrammer.com/docs/nodes/aws" target="_blank" rel="noopener noreferrer">Available Nodes</a></td>
</tr>
<tr>
<td><a href="https://github.com/mingrammer/diagrams/issues/202" target="_blank" rel="noopener noreferrer">Individual Node Edits</a></td>
</tr>
<tr>
<td><a href="https://www.graphviz.org/doc/info/attrs.html" target="_blank" rel="noopener noreferrer">Reference for Graph Attributes</a></td>
</tr>
</tbody>
</table>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://bit.ly/3e4t2Mf" target="_blank" rel="noopener noreferrer">Diagram GitHub Project</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://bit.ly/2PDy9tj" target="_blank" rel="noopener noreferrer">Introduction | Documentation | Poetry - Python dependency management and packaging made easy.</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><a href="https://bit.ly/3vzbuhe" target="_blank" rel="noopener noreferrer">Diagram Project - AWS Diagram Node List</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p><a href="https://amzn.to/3nBhSSc" target="_blank" rel="noopener noreferrer">AWS Reference Architecture Diagrams</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p><a href="https://bit.ly/3e6YrxD" target="_blank" rel="noopener noreferrer">Pull Request Continuous Integration Reference Architecture</a>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

        ]]>
    <a href="https://brid.gy/publish/twitter"></a>
    <data class="p-bridgy-omit-link" value="false"></data>
    </description>
</item>


<item>
    <title>
        Getting Started With Python For Data Exploration
    </title>
    <link>
        https://www.sheldonhull.com/getting-starting-with-python-for-data-exploration/
    </link>
    <pubDate>
        Tue, 19 Nov 2019 16:51:08 &#43;0000
    </pubDate>
    
    
    <guid>
        https://www.sheldonhull.com/getting-starting-with-python-for-data-exploration/
    </guid>
    <description>
        <![CDATA[
        
        
        
            
        
        <h2 id="intro" class="headerLink">
    <a href="#intro" class="header-mark"></a>Intro</h2><p>To get started with running python queries with SQL Server is actually pretty easy. I waited far too long to tackle this, thinking it was much harder than it turned out to be. Hopefully, this can be a good starting point for you as well.</p>
<h2 id="why-would-i-want-to-do-this" class="headerLink">
    <a href="#why-would-i-want-to-do-this" class="header-mark"></a>Why would I want to do this?</h2><p>When you use great tools like dbatools with PowerShell, you come to think that PowerShell is a first class citizen for working with SQL Server. This is true in regards to administration and general usage. However, data exploration is a different beast.</p>
<h2 id="powershell--net-are-not-designed-for-adhoc-data-exploration" class="headerLink">
    <a href="#powershell--net-are-not-designed-for-adhoc-data-exploration" class="header-mark"></a>PowerShell &amp; .NET Are Not Designed for Adhoc Data Exploration</h2><p>First, can they? Yes. But just because there is a library someone created to give you some of these features, are the languages themselves first class data exploration languages, especially for adhoc and exploratory work. I think most would agree: <em>no</em>.</p>
<p>To be very clear, I know there are possibilities, such as the newer Azure Data Studio powershell notebook feature, and likely other modules that can help with exploration. What I&rsquo;m trying to be clear about is that those are all exceptions to the rule, whereas exploration in Python is a first class citizen from the start. (coming from a dedicated PowerShell addict &#x1f601;)</p>
<p>Traditionally, I&rsquo;ve used Azure Data Studio or SQL Management Studio and run individually queries in a large sql script to explore and manipulate the data. However, once you start wanting to pivot, aggregate, sum, and do various other experimental actions, T-SQL can be over complicated to do this for that adhoc work. Just because you can do unpivot doesn&rsquo;t mean it&rsquo;s a smarter use of time than using a pivot table in Excel for adhoc work (as much as it pains me to say).</p>
<div
    class="details admonition info
      open
    "
  >
    <div class="details-summary admonition-title">
      <i
        class="icon fas fa-info-circle fa-fw"
      ></i>
      Azure Data Studio
      <i class="details-icon fas fa-angle-right fa-fw"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">Azure data studio is making great progress with SQL Server based notebooks, which I highly recommend checking out. It&rsquo;s still in its infancy. So while it&rsquo;s pretty useful for basics, if you want to stick with a scripted approach to explore, python will be superior. Just recently PowerShell based code cells are available too, I believe.</div>
    </div>
  </div>
<p>However, even better than playing around with data in an Excel sheet, what if you wanted to stay in your programmatic script and start slicing and dicing the data coming back, molding into &ldquo;tidy data&rdquo; for what you want to analyze?</p>
<p>PowerShell and .NET don&rsquo;t have the intuitive and experimental data exploration capabilities that have existed for a long time in the Python libraries. They can easily manipulate, group, mold and visualize the data with minimal effort. This is the forte of Python&rsquo;s libraries, and has much more maturity than doing some homegrown solution work around.</p>
<h2 id="jupyter-notebooks" class="headerLink">
    <a href="#jupyter-notebooks" class="header-mark"></a>Jupyter Notebooks</h2><p>I&rsquo;m sticking with Visual Studio Code, so install the python extension <code>ms-python.python</code> and then create a new notebook directly from the command pallet. Once you open this up you can start writing some markdown notes and then running queries and visualizing the results in one place.</p>
<h2 id="python-plotly-library" class="headerLink">
    <a href="#python-plotly-library" class="header-mark"></a>Python Plotly Library</h2><p>The standard libraries are pretty good. I wanted something that also created graphs that I&rsquo;d consider pleasing to the eye. The default <code>matplotlib</code> wasn&rsquo;t really what I was looking for, so I used <code>plotly</code>. This fantastic library has an express edition that gets you up and running in minutes playing with data, and can even convert your visualizations into a nice web app dashboard with <code>Dash</code> (also a plotly product).</p>
<h2 id="pandas" class="headerLink">
    <a href="#pandas" class="header-mark"></a>Pandas</h2><p>In addition to working with <code>plotly</code> I leveraged <code>pandas</code>. I think from my initial working with it, that this library will be a staple for my adhoc data work for a long time. It basically provides a nice easy way to work with <code>Dataframes</code>, which is kinda of like working with a .NET <code>datatable</code>, albeit, many extensibility, exporting, and other features built into it. I found it intuitive and pretty easy to work with.</p>
<h2 id="installing-pyodbc" class="headerLink">
    <a href="#installing-pyodbc" class="header-mark"></a>Installing pyodbc</h2><div
    class="details admonition info
      open
    "
  >
    <div class="details-summary admonition-title">
      <i
        class="icon fas fa-info-circle fa-fw"
      ></i>
      platform
      <i class="details-icon fas fa-angle-right fa-fw"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>This guide is written for someone using a Windows based development environment. The setup requirements for running in Linux/Mac will be different for drivers</p>
<p>For running in AWS Lambda in python runtime, there are more complex issues requiring the driver to be compiled and uploaded to a Lambda layer for use. Windows dev machine doesn&rsquo;t have this requirement and should just work after running ODBC driver install and pyodbc. &#x1f389;</p>
</div>
    </div>
  </div>
<ol>
<li><a href="https://docs.microsoft.com/en-us/sql/connect/odbc/download-odbc-driver-for-sql-server" title="SQL Server ODBC Drivers" target="_blank" rel="noopener noreferrer">Link for SQL Server ODBC Drivers</a></li>
<li><code>pip3 install pyodbc</code></li>
</ol>
<h2 id="generate-connection-file" class="headerLink">
    <a href="#generate-connection-file" class="header-mark"></a>Generate Connection File</h2><p>If you are constantly changing the SQL Server instance you are connecting to, then you may just want provide variables for your script. In my test case, I wanted to create a default connection file that I could use in several scripts to avoid having to set in each module file.</p>
<p>I found some great examples online and cobbled this together from several.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">configparser</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">keyring</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">xlsxwriter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">service_account</span> <span class="o">=</span> <span class="s2">&#34;DomainOfTheTaco</span><span class="se">\\</span><span class="s2">TacoEater&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">sql_login_name</span> <span class="o">=</span> <span class="s2">&#34;TACO-HIGH-PRIEST&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">sql_instance</span> <span class="o">=</span> <span class="s2">&#34;TACO-SERVER-01&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">driver_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">driver_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">drivers</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39; for SQL Server&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The following ODBC drivers were identified on your system&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">driver_names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">driver_names</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">driver_name</span> <span class="o">=</span> <span class="n">driver_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">driver_name</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQL_SERVER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;DRIVER&#39;</span><span class="p">:</span> <span class="n">driver_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;SERVER&#39;</span><span class="p">:</span> <span class="n">sql_instance</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;DATABASE&#39;</span><span class="p">:</span> <span class="s2">&#34;master&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;Trusted_Connection&#39;</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;APP&#34;</span><span class="p">:</span> <span class="s2">&#34;PythonTamer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;UID&#34;</span><span class="p">:</span> <span class="n">sql_login_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;PWD&#34;</span><span class="p">:</span> <span class="n">keyring</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="n">service_account</span><span class="p">,</span><span class="n">service_account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;db_connect.ini&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(No suitable driver found. Cannot connect.)&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Since I had 2 versions of ODBC drivers available, this is what came up:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">The following ODBC drivers were identified on your system
</span></span><span class="line"><span class="cl">[&#39;ODBC Driver 13 for SQL Server&#39;, &#39;ODBC Driver 17 for SQL Server&#39;]
</span></span></code></pre></td></tr></table>
</div>
</div><p>This generated a connection file I could use in other py files I wanted. The file generated in my user directory <code>$ENV:USERPROFILE</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">[SQL_SERVER]
</span></span><span class="line"><span class="cl">driver = ODBC Driver 17 for SQL Server
</span></span><span class="line"><span class="cl">server = TACO-SERVER-01
</span></span><span class="line"><span class="cl">database = master
</span></span><span class="line"><span class="cl">trusted_connection = yes
</span></span><span class="line"><span class="cl">app = PythonTamer
</span></span><span class="line"><span class="cl">uid = TACO-HIGH-PRIEST
</span></span><span class="line"><span class="cl">pwd = redactedtacos
</span></span></code></pre></td></tr></table>
</div>
</div><p>This could then be used in python files like below</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">configparser</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pyodbc</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;db_connect.ini&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">constr</span> <span class="o">=</span> <span class="s1">&#39;DRIVER={{</span><span class="si">{drv}</span><span class="s1">}};SERVER=</span><span class="si">{srv}</span><span class="s1">;DATABASE=</span><span class="si">{db}</span><span class="s1">;Trusted_Connection=</span><span class="si">{tc}</span><span class="s1">;APP=</span><span class="si">{app}</span><span class="s1">;UID=</span><span class="si">{uid}</span><span class="s1">;PWD=</span><span class="si">{pwd}</span><span class="s1">&#39;</span>\
</span></span><span class="line"><span class="cl">              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">drv</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQL_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;DRIVER&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="n">srv</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQL_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;SERVER&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="n">db</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQL_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="n">tc</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQL_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;Trusted_Connection&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="n">app</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQL_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;APP&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="n">uid</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQL_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;UID&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="n">pwd</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQL_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;PWD&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                      <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cnxn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This connection object then would allow running queries similar to executing <code>ADO.NET</code> queries.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">out_xlsx</span> <span class="o">=</span> <span class="s2">&#34;C://temp//python-sql-export.xlsx&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">cnxn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">select
</span></span></span><span class="line"><span class="cl"><span class="s2">    name
</span></span></span><span class="line"><span class="cl"><span class="s2">from
</span></span></span><span class="line"><span class="cl"><span class="s2">    sys.databases
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">,</span><span class="n">cnxn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Exporting to </span><span class="si">{</span><span class="n">out_xlsx</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data_frame</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">out_xlsx</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;finished query&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>To sample in your notebook a few random entries, try this</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data_frame</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You should have an excel workbook exported after this. This was even more succinct than using <code>ImportExcel</code> PowerShell module which is my normal go to.</p>
<h2 id="group-results-into-ranges" class="headerLink">
    <a href="#group-results-into-ranges" class="header-mark"></a>Group Results Into Ranges</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># How many results are being returned?</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># These are the buckets I want to return results in</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ie, how many of my results fit into the 0-250 range, and how many 500. These are not fixed ranges.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Histograms do this type of work as well, I&#39;m showing the grouping overriden at specific ranges with a dataframe in Pandas.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">3000</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">6000</span><span class="p">,</span><span class="mi">7000</span><span class="p">,</span><span class="mi">10000</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">groupby</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ranges</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">groupby</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Plotly express visualization</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&#34;time&#34;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&#34;value&#34;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;MyFancyTitle&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">               time  metric  value
</span></span><span class="line"><span class="cl">value
</span></span><span class="line"><span class="cl">(0, 250]       1652    1652   1652
</span></span><span class="line"><span class="cl">(250, 500]       22      22     22
</span></span><span class="line"><span class="cl">(500, 1000]      10      10     10
</span></span><span class="line"><span class="cl">(1000, 2000]      9       9      9
</span></span><span class="line"><span class="cl">(2000, 3000]      2       2      2
</span></span><span class="line"><span class="cl">(3000, 4000]      1       1      1
</span></span><span class="line"><span class="cl">(4000, 5000]      5       5      5
</span></span><span class="line"><span class="cl">(5000, 6000]      9       9      9
</span></span><span class="line"><span class="cl">(6000, 7000]      2       2      2
</span></span><span class="line"><span class="cl">(7000, 10000]     1       1      1
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is pretty cool, as while you can do this with windowing functions in SQL Server, for adhoc work, I was able to do this in 2 lines. This could save a lot of time and debugging over more complex T-SQL procs.</p>
<h2 id="scatterchart" class="headerLink">
    <a href="#scatterchart" class="header-mark"></a>Scatterchart</h2><p>Never having really used scattercharts, I&rsquo;m seeing in data exploration they can be a tremendously valuable tool.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&#34;metric&#34;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&#34;value&#34;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;MyFancyTitle&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s2">&#34;value&#34;</span><span class="p">,</span><span class="n">render_mode</span><span class="o">=</span><span class="s2">&#34;auto&#34;</span><span class="p">,</span><span class="n">marginal_y</span><span class="o">=</span><span class="s2">&#34;rug&#34;</span><span class="p">,</span><span class="n">marginal_x</span><span class="o">=</span><span class="s2">&#34;histogram&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="quick-example" class="headerLink">
    <a href="#quick-example" class="header-mark"></a>Quick Example</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">pip3</span> <span class="n">install</span> <span class="n">pydataset</span> <span class="c">#optional for more than iris data</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydataset</span> <span class="kn">import</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">titanic</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="s1">&#39;titanic&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This results in output like the image below</p>
<p><figure><a class="lightgallery" href="/images/2019-11-05_20-50-29-notebook1.jpg" title="Notebook Output Sample for Titanic" data-thumbnail="/images/2019-11-05_20-50-29-notebook1.jpg">
        
    </a></figure></p>
<p>To generate a more advanced visualization, you can run something to visualize with <code>plotly</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydataset</span> <span class="kn">import</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="s1">&#39;iris&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&#34;Petal.Width&#34;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&#34;Sepal.Width&#34;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Iris Data Example&#39;</span><span class="p">,</span><span class="n">render_mode</span><span class="o">=</span><span class="s2">&#34;auto&#34;</span><span class="p">,</span><span class="n">marginal_y</span><span class="o">=</span><span class="s2">&#34;rug&#34;</span><span class="p">,</span><span class="n">marginal_x</span><span class="o">=</span><span class="s2">&#34;histogram&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="/images/2019-11-05_21-23-36-notebook2.jpg" title="Scatter Chart" data-thumbnail="/images/2019-11-05_21-23-36-notebook2.jpg">
        
    </a></figure></p>
<h2 id="wrap-up" class="headerLink">
    <a href="#wrap-up" class="header-mark"></a>Wrap Up</h2><p>Lots of great options to visualize data with Python &#x1f600; . I&rsquo;ll definitely be spending more time learning how to manipulate and query datasets with Python, and eventually give Dash by Plotly a try as well. I&rsquo;ve enjoyed Grafana, but it&rsquo;s really meant for time series monitoring, not for the flexible data visualization options that can be done so easily in Python.</p>
<p>Hopefully, this gave you a good start on some of the benefits and ease of use of Python if you, like me, are coming from a PowerShell and SQL Server heavy background, and have wanted to know more about Python. &#x1f32e;</p>

        ]]>
    <a href="https://brid.gy/publish/twitter"></a>
    <data class="p-bridgy-omit-link" value="false"></data>
    </description>
</item>
</channel>
</rss>
